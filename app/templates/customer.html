<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BI360-Customer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/orderStyles.css') }}">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <a href="{{ url_for('customers_analysis') }}"><h1 class="logo">BI360 - Customer Analysis</h1></a>

            <nav>
                <ul>
                    <li><a href="{{ url_for('orders_analysis') }}">Order Analysis</a></li>
                    <li><a href="{{ url_for('sales_analysis') }}">Sales Analysis</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="main-content">
        <div class="container">
            <div class="charts-container">
                <div class="chart-container">
                    <h2>Customer Summary</h2>
                            {% for key, value in customer_summary.items() %}
                            <div class="card">
                                <strong><h3>{{key}}</h3></strong><br></hr>
                                {{value}}
                            
                            </div>
                            {% endfor %}
                        </ul>
                </div>

                <div class="chart-container">
                    <h2>Cities with highest customers</h2>
                    <canvas id="cityWiseCustomers" width="400" height="300"></canvas>
                </div>
                <div class="chart-container">
                    <h2>Customer Segments by Lifetime Value</h2>
                    <canvas id="lifeTimeValue" width="400" height="300"></canvas>
                </div>

                <div class="chart-container">
                    <h2>Customers Reviews VS Rating</h2>
                    <canvas id="reviewVsRating" width="400" height="300"></canvas>
                </div>

                <div class="chart-container">
                    <h2>Customer Segments by RFM</h2>
                    <canvas id="rfmSegment" width="400" height="300"></canvas>
                </div>
                <div class="chart-container">
                    <h2>Customer RFM Segmentation Ratio</h2>
                    <canvas id="rfmRatio" width="400" height="300"></canvas>
                </div>
                
                
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>&copy; BI360</p>
        </div>
    </footer>

    <!-- <script src="script.js"></script> -->
    <!-- <script src="{{ url_for('static',filename='script.js') }}"> </script> -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
    fetch('/highest_customers_cities')
        .then(response => response.json())
        .then(data => {
            const cities = Object.keys(data);
            const customersCount = Object.values(data);

            var cityWiseCustomersBar = {
                labels: cities,
                values: customersCount,
                backgroundColor: [
                'rgba(255, 99, 132, 0.5)',
                'rgba(54, 162, 235, 0.5)',
                'rgba(255, 206, 86, 0.5)',
                'rgba(75, 192, 192, 0.5)',
                'rgba(102, 153, 255, 0.5)',
                'rgba(153, 200, 100, 0.5)',
                'rgba(153, 102, 150, 0.5)',
                'rgba(153, 115, 288, 0.5)',
                'rgba(153, 255, 102, 0.5)',
                ],
                borderWidth: 1
                };

            new Chart(document.getElementById('cityWiseCustomers'), {
                type: 'bar',
                data: {
                    labels: cityWiseCustomersBar.labels,
                    datasets: [{
                        label: cityWiseCustomersBar.labels,
                        data: cityWiseCustomersBar.values,
                        backgroundColor: cityWiseCustomersBar.backgroundColor,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        });
});


document.addEventListener('DOMContentLoaded', function () {
    fetch('/reviews_vs_rating')
        .then(response => response.json())
        .then(data => {
            const rating = Object.keys(data);
            const reviews = Object.values(data);

            var reviewRating = {
                labels: rating,
                values: reviews,
                backgroundColor: [
                'rgba(153, 200, 100, 0.5)',
                'rgba(153, 102, 150, 0.5)',
                'rgba(153, 115, 288, 0.5)',
                'rgba(153, 255, 102, 0.5)',
                'rgba(112, 224, 162, 0.5)',
                ],
                borderWidth: 1
                };

            new Chart(document.getElementById('reviewVsRating'), {
                type: 'bar',
                data: {
                    labels: reviewRating.labels,
                    datasets: [{
                        label: reviewRating.labels,
                        data: reviewRating.values,
                        backgroundColor: reviewRating.backgroundColor,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        });
});

document.addEventListener('DOMContentLoaded', function () {
    fetch('/customers_rfm_segment')
        .then(response => response.json())
        .then(data => {
            const rfmLabels = Object.keys(data);
            const rfmcount = Object.values(data);

            var rfmSegmentCountDataPie = {
                labels: rfmLabels,
                values: rfmcount,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.5)',
                    'rgba(255, 199, 192, 0.5)',
                    'rgba(54, 162, 235, 0.5)',
                    'rgba(255, 206, 86, 0.5)',
                    'rgba(75, 192, 192, 0.5)',
                    'rgba(102, 153, 255, 0.5)',
                    'rgba(153, 200, 100, 0.5)',
                    'rgba(153, 102, 150, 0.5)',
                    'rgba(153, 115, 288, 0.5)',
                    'rgba(153, 255, 102, 0.5)',
                    'rgba(112, 224, 162, 0.5)',
                ],
                borderWidth: 1
                };

            new Chart(document.getElementById('rfmSegment'), {
                type: 'bar',
                data: {
                    labels: rfmSegmentCountDataPie.labels,
                    datasets: [{
                        label: rfmSegmentCountDataPie.labels,
                        data: rfmSegmentCountDataPie.values,
                        backgroundColor: rfmSegmentCountDataPie.backgroundColor,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: 'rgb(255, 99, 132)'
                            }
                        }
                    }
                }
            });
        });
});

document.addEventListener('DOMContentLoaded', function () {
    fetch('/customers_rfm_ratio')
        .then(response => response.json())
        .then(data => {
            const rfmSegment = Object.keys(data);
            const rfmRatio = Object.values(data);
        
            var rfmSegmentDataPie = {
                labels: rfmSegment,
                values: rfmRatio,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.5)',
                    'rgba(255, 199, 192, 0.5)',
                    'rgba(54, 162, 235, 0.5)',
                    'rgba(255, 206, 86, 0.5)',
                    'rgba(75, 192, 192, 0.5)',
                    'rgba(102, 153, 255, 0.5)',
                    'rgba(153, 200, 100, 0.5)',
                    'rgba(153, 102, 150, 0.5)',
                    'rgba(153, 115, 288, 0.5)',
                    'rgba(153, 255, 102, 0.5)',
                    'rgba(112, 224, 162, 0.5)',
                ],
                borderWidth: 1
                };
        
            new Chart(document.getElementById('rfmRatio'), {
                type: 'pie',
                data: {
                    labels:  rfmSegmentDataPie.labels,
                    datasets: [{
                        label:rfmSegmentDataPie.keys,
                        data: rfmSegmentDataPie.values,
                        backgroundColor: rfmSegmentDataPie.backgroundColor,
                        borderWidth: rfmSegmentDataPie.borderWidth
                    }]
                },
                options: {
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: 'rgb(255, 99, 132)'
                            }
                        }
                    }
                }
            });
        });
});

document.addEventListener('DOMContentLoaded', function () {
    fetch('/customers_lifetime_value_segment')
        .then(response => response.json())
        .then(data => {
            const lSegment = Object.keys(data);
            const lCount = Object.values(data);
            var lifetimeSegmentDataPie = {
                labels: lSegment,
                values: lCount,
                backgroundColor: [
                'rgba(75, 192, 192, 0.5)',
                'rgba(255, 206, 86, 0.5)',
                'rgba(255, 99, 132, 0.5)',
                
                
                
                ],
                borderWidth: 1
                };
        
            new Chart(document.getElementById('lifeTimeValue'), {
                type: 'pie',
                data: {
                    labels:  lifetimeSegmentDataPie.labels,
                    datasets: [{
                        data: lifetimeSegmentDataPie.values,
                        backgroundColor: lifetimeSegmentDataPie.backgroundColor,
                        borderWidth:lifetimeSegmentDataPie.borderWidth
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    title: {
                        display: true,
                        text: 'Segmentation by Lifetime'
                    }
                    
                }
            });
        });
});



    </script>

</body>
</html>